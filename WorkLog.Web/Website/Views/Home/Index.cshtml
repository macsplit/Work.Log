@model HierarchyViewModel
@{
    ViewData["Title"] = "Dashboard";
}

<div class="dashboard-layout">
    <!-- Left sidebar: Hierarchy navigation -->
    <aside class="hierarchy-panel">
        <div class="panel-header">
            <h2>Navigate</h2>
            <a asp-controller="Session" asp-action="Create"
               asp-route-date="@Model.SelectedDate?.ToString("yyyy-MM-dd")"
               class="btn btn-primary btn-sm">+ New Session</a>
        </div>

        <!-- Years -->
        <div class="hierarchy-section">
            <h3>Years</h3>
            @if (Model.Years.Any())
            {
                <ul class="hierarchy-list">
                    @foreach (var year in Model.Years)
                    {
                        <li class="@(Model.SelectedYear == year ? "selected" : "")">
                            <a asp-action="Index" asp-route-year="@year">@year</a>
                        </li>
                    }
                </ul>
            }
            else
            {
                <p class="empty-message">No sessions recorded yet</p>
            }
        </div>

        <!-- Months -->
        @if (Model.SelectedYear.HasValue && Model.Months.Any())
        {
            <div class="hierarchy-section indented">
                <h3>Months</h3>
                <ul class="hierarchy-list">
                    @foreach (var month in Model.Months)
                    {
                        <li class="@(Model.SelectedMonth == month ? "selected" : "")">
                            <a asp-action="Index"
                               asp-route-year="@Model.SelectedYear"
                               asp-route-month="@month">@Model.GetMonthName(month)</a>
                        </li>
                    }
                </ul>
            </div>
        }

        <!-- Weeks -->
        @if (Model.SelectedMonth.HasValue && Model.Weeks.Any())
        {
            <div class="hierarchy-section indented-2">
                <h3>Weeks</h3>
                <ul class="hierarchy-list">
                    @foreach (var week in Model.Weeks)
                    {
                        <li class="@(Model.SelectedWeek == week ? "selected" : "")">
                            <a asp-action="Index"
                               asp-route-year="@Model.SelectedYear"
                               asp-route-month="@Model.SelectedMonth"
                               asp-route-week="@week">@Model.GetWeekLabel(week)</a>
                        </li>
                    }
                </ul>
            </div>
        }

        <!-- Days -->
        @if (Model.SelectedMonth.HasValue && Model.Days.Any())
        {
            <div class="hierarchy-section indented-3">
                <h3>Days</h3>
                <ul class="hierarchy-list">
                    @foreach (var day in Model.Days)
                    {
                        <li class="@(Model.SelectedDate == day ? "selected" : "")">
                            <a asp-action="Index"
                               asp-route-year="@Model.SelectedYear"
                               asp-route-month="@Model.SelectedMonth"
                               asp-route-week="@Model.SelectedWeek"
                               asp-route-date="@day.ToString("yyyy-MM-dd")">@Model.GetDayLabel(day)</a>
                        </li>
                    }
                </ul>
            </div>
        }
    </aside>

    <!-- Main content area -->
    <main class="content-panel">
        @if (Model.SelectedDate.HasValue)
        {
            <div class="day-header">
                <h1>@Model.SelectedDate.Value.ToString("dddd, MMMM d, yyyy")</h1>
                <div class="day-summary">
                    <span class="total-hours">@Model.TotalHours hours</span>
                    <span class="session-count">@Model.Sessions.Count session(s)</span>
                </div>
            </div>

            <!-- Session list -->
            <div class="sessions-panel">
                @if (Model.Sessions.Any())
                {
                    <div class="session-list">
                        @foreach (var session in Model.Sessions)
                        {
                            <div class="session-card" data-session-id="@session.Id">
                                <div class="session-header">
                                    <span class="session-time">@session.TimeHours hour(s)</span>
                                    @if (session.Tag != null)
                                    {
                                        <span class="tag-badge">@session.Tag.Name</span>
                                    }
                                    <div class="session-actions">
                                        <a asp-controller="Session" asp-action="Edit" asp-route-id="@session.Id"
                                           class="btn btn-sm">Edit</a>
                                        <form asp-controller="Session" asp-action="Delete" asp-route-id="@session.Id"
                                              method="post" class="delete-form"
                                              onsubmit="return confirm('Are you sure you want to delete this session?');">
                                            @Html.AntiForgeryToken()
                                            <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                        </form>
                                    </div>
                                </div>
                                <div class="session-description">
                                    <p>@session.Description</p>
                                </div>
                                @if (!string.IsNullOrEmpty(session.Notes))
                                {
                                    <div class="session-notes">
                                        <strong>Notes:</strong>
                                        <p>@session.Notes</p>
                                    </div>
                                }
                                @if (!string.IsNullOrEmpty(session.NextPlannedStage))
                                {
                                    <div class="session-next">
                                        <strong>Next Planned Stage:</strong>
                                        <p>@session.NextPlannedStage</p>
                                    </div>
                                }
                            </div>
                        }
                    </div>
                }
                else
                {
                    <div class="empty-state">
                        <p>No sessions for this day</p>
                        <a asp-controller="Session" asp-action="Create"
                           asp-route-date="@Model.SelectedDate.Value.ToString("yyyy-MM-dd")"
                           class="btn btn-primary">Add First Session</a>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="welcome-message">
                <h1>Welcome to Work Log</h1>
                <p>Select a date from the hierarchy to view or add work sessions.</p>
                @if (!Model.Years.Any())
                {
                    <a asp-controller="Session" asp-action="Create" class="btn btn-primary">Add Your First Session</a>
                }
            </div>
        }
    </main>
</div>
